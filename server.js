const Prometheus = require('prom-client')
const express = require('express');
const http = require('http');
const path = require("path");
const homedir = require("os").homedir();
let fetch = require("node-fetch");
const fs = require('fs').promises;

Prometheus.collectDefaultMetrics();

const requestHistogram = new Prometheus.Histogram({
    name: 'http_request_duration_seconds',
    help: 'Duration of HTTP requests in seconds',
    labelNames: ['code', 'handler', 'method'],
    buckets: [0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1, 2.5, 5]
})

const requestTimer = (req, res, next) => {
  const path = new URL(req.url, `http://${req.hostname}`).pathname
  const stop = requestHistogram.startTimer({
    method: req.method,
    handler: path
  })
  res.on('finish', () => {
    stop({
      code: res.statusCode
    })
  })
  next()
}

const app = express();
const server = http.createServer(app)

// See: http://expressjs.com/en/4x/api.html#app.settings.table
const PRODUCTION = app.get('env') === 'production';

// Administrative routes are not timed or logged, but for non-admin routes, pino
// overhead is included in timing.
app.get('/ready', (req, res) => res.status(200).json({status:"ok"}));
app.get('/live', (req, res) => res.status(200).json({status:"ok"}));
app.get('/metrics', async (req, res, next) => {
  const metrics = await Prometheus.register.metrics();
  res.set('Content-Type', Prometheus.register.contentType)
  res.end(metrics);
})

// Time routes after here.
app.use(requestTimer);

// Log routes after here.
const pino = require('pino')({
  level: PRODUCTION ? 'info' : 'debug',
});
app.use(require('pino-http')({logger: pino}));

app.get('/test1', (req, res) => {
  // Use req.log (a `pino` instance) to log JSON:
  req.log.info({message: 'Hello from Node.js Starter Application!'});
  res.send('Hello from Node.js Starter Application! Saurabh K Sinha');
});

app.get('/test2', (req, res) => {
  // Use req.log (a `pino` instance) to log JSON:
  //req.log.info({message: 'Hello from Node.js Starter Application!'});
  res.sendFile('index.html', { root: __dirname })
});



app.get('/', (req, res) => {

  var options = {
    "method": "GET"
  };
  fetch('https://miserabletimelyquery.saurabhksinha90.repl.co/view_nft?account_id=saurabhksinha900.testnet', options).then(res => res.json())
    .then((jsontoken) => {
      console.log(jsontoken[0]);
      let text = '<html><link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><body><div class="w3-container">   <div class="w3-bar w3-black">    <a href="https://InfyNFT.saurabhksinha90.repl.co/home" class="w3-bar-item w3-button w3-mobile w3-green">Home</a>   <a href="https://infynft.saurabhksinha90.repl.co/store_file" class="w3-bar-item w3-button w3-mobile">Upload File</a>    <a href="https://infynft.saurabhksinha90.repl.co/nft_mint?metadata_media=" class="w3-bar-item w3-button w3-mobile">Mint NFT</a>   <div class="w3-dropdown-hover w3-mobile">      <button class="w3-button">NFT <i class="fa fa-caret-down"></i></button>     <div class="w3-dropdown-content w3-bar-block w3-dark-grey">        <a href="https://infynft.saurabhksinha90.repl.co/nft_mint?metadata_media=" class="w3-bar-item w3-button w3-mobile">Mint NFT</a>       <a href="https://infynft.saurabhksinha90.repl.co/view_nft_marketplace" class="w3-bar-item w3-button w3-mobile">View NFT</a>        <a href="https://infynft.saurabhksinha90.repl.co/store_file" class="w3-bar-item w3-button w3-mobile">Store NFT</a>     </div>    </div> <a href="https://infynft.saurabhksinha90.repl.co/send" class="w3-bar-item w3-button w3-mobile">Send Asset</a><a href="https://infynft.saurabhksinha90.repl.co/receive" class="w3-bar-item w3-button w3-mobile">Receive Asset</a>   <div class="w3-dropdown-hover w3-mobile">      <button class="w3-button">Asset <i class="fa fa-caret-down"></i></button>     <div class="w3-dropdown-content w3-bar-block w3-dark-grey">        <a href="https://infynft.saurabhksinha90.repl.co/send" class="w3-bar-item w3-button w3-mobile">Send</a>       <a href="https://infynft.saurabhksinha90.repl.co/receive" class="w3-bar-item w3-button w3-mobile">Receive</a>         </div>    </div></div>';
      text = text + "<H1 align='center'  style='color:blue;'> Rewards and Recognition Platform</h1><br><br><table align='center' style='border: 1px solid black;'><tr style='border: 1px solid black;'><td align='center' style='border: 1px solid black;'><b>metadata_media</b></td><td align='center'style='border: 1px solid black;'> <b>token_id</b></td><td align='center' style='border: 1px solid black;'> <b>owner_id</b></td><td align='center' style='border: 1px solid black;'> <b>metadata_title</b></td><td align='center' style='border: 1px solid black;'> <b>metadata_description</b></td><td align='center' style='border: 1px solid black;'> <b>metadata_copies</td><td align='center' style='border: 1px solid black;'> <b>Transfer NFT</b></td></tr>"

      for (var i = 0; i < jsontoken.length; i++) {

        text = text + "<tr style='border: 1px solid black;'><td align='center' style='border: 1px solid black;'> <a href='https://infynft.saurabhksinha90.repl.co/nft_transfer?token_id=" + jsontoken[i].token_id + "&metadata_media=" + (jsontoken[i].metadata_media).replace("?", "%3F") + "&metadata_title=" + (jsontoken[i].metadata_title) + "&metadata_description=" + (jsontoken[i].metadata_description) + "&metadata_copies=" + (jsontoken[i].metadata_copies) + "&metadata_media_hash=" + (jsontoken[i].metadata_media_hash) + "&metadata_issued_at=" + (jsontoken[i].metadata_issued_at) + "&metadata_expires_at=" + (jsontoken[i].metadata_expires_at) + "&metadata_starts_at=" + (jsontoken[i].metadata_starts_at) + "&metadata_updated_at=" + (jsontoken[i].metadata_updated_at) + "&metadata_extra=" + (jsontoken[i].metadata_extra) + "&metadata_reference=" + (jsontoken[i].metadata_reference) + "&metadata_reference_hash=" + (jsontoken[i].metadata_reference_hash) + "&approved_account_ids=" + (jsontoken[i].approved_account_ids) + "&owner_id=" + (jsontoken[i].owner_id) + "'><img height='37px' width='37px' src='" + (jsontoken[i].metadata_media).replace("?", "%3F") + "'></a></td><td align='center' style='border: 1px solid black;'> <b>" + (jsontoken[i].token_id) + "</b></td><td align='center' style='border: 1px solid black;'> <b>" + (jsontoken[i].owner_id) + "</b></td><td align='center' style='border: 1px solid black;'> <b>" + (jsontoken[i].metadata_title) + "</b></td><td align='center' style='border: 1px solid black;'> <b>" + (jsontoken[i].metadata_description) + "</b></td><td align='center' style='border: 1px solid black;'> <b>" + (jsontoken[i].metadata_copies) + "</b></td><td align='center' style='border: 1px solid black;'> <a href='https://infynft.saurabhksinha90.repl.co/nft_transfer?token_id=" + jsontoken[i].token_id + "&metadata_media=" + (jsontoken[i].metadata_media).replace("?", "%3F") + "&metadata_title=" + (jsontoken[i].metadata_title) + "&metadata_description=" + (jsontoken[i].metadata_description) + "&metadata_copies=" + (jsontoken[i].metadata_copies) + "&metadata_media_hash=" + (jsontoken[i].metadata_media_hash) + "&metadata_issued_at=" + (jsontoken[i].metadata_issued_at) + "&metadata_expires_at=" + (jsontoken[i].metadata_expires_at) + "&metadata_starts_at=" + (jsontoken[i].metadata_starts_at) + "&metadata_updated_at=" + (jsontoken[i].metadata_updated_at) + "&metadata_extra=" + (jsontoken[i].metadata_extra) + "&metadata_reference=" + (jsontoken[i].metadata_reference) + "&metadata_reference_hash=" + (jsontoken[i].metadata_reference_hash) + "&approved_account_ids=" + (jsontoken[i].approved_account_ids) + "&owner_id=" + (jsontoken[i].owner_id) + "'><button onclick='document.getElementById(&quot;id01&quot;).style.display=&quot;block&quot;' style='background-color:blue; border-color:black; color:white;  width:auto;'>Transfer NFT!</button></a></td></tr>";
      }
      text = text + "</table></div><br/><br/></body></html>";

      res.send(text);
    });
});

app.get('/store_file', (req, res) => {

  res.send("<html><style>body {font-family: Arial, Helvetica, sans-serif;}input[type=text], input[type=password] {  width: 100%; padding: 12px 20px;  margin: 8px 0; display: inline-block;  border: 1px solid #ccc; box-sizing: border-box;}button {  background-color: #04AA6D; color: white;  padding: 14px 20px; margin: 8px 0;  border: none; cursor: pointer;  width: 100%;utton:hover {  opacity: 0.8;cancelbtn {  width: auto; padding: 10px 18px;  background-color: #f44336;imgcontainer {  text-align: center; margin: 24px 0 12px 0;}img.avatar {  width: 40%; border-radius: 50%;}.container {  padding: 16px;pan.psw {  float: right; padding-top: 16px;}/* Change styles for span and cancel button on extra small screens */@media screen and (max-width: 300px) { span.psw {     display: block;    float: none;  } .cancelbtn {     width: 100%; }}</style><link rel='stylesheet' href='https://www.w3schools.com/w3css/4/w3.css'><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'><body><div class='w3-container'>   <div class='w3-bar w3-black'>    <a href='https://InfyNFT.saurabhksinha90.repl.co/home' class='w3-bar-item w3-button w3-mobile w3-green'>Home</a>   <a href='https://infynft.saurabhksinha90.repl.co/store_file' class='w3-bar-item w3-button w3-mobile'>Upload File</a>    <a href='https://infynft.saurabhksinha90.repl.co/nft_mint?metadata_media=' class='w3-bar-item w3-button w3-mobile'>Mint NFT</a>   <div class='w3-dropdown-hover w3-mobile'>      <button class='w3-button'>NFT <i class='fa fa-caret-down'></i></button>     <div class='w3-dropdown-content w3-bar-block w3-dark-grey'>        <a href='https://infynft.saurabhksinha90.repl.co/nft_mint?metadata_media=' class='w3-bar-item w3-button w3-mobile'>Mint NFT</a>       <a href='https://infynft.saurabhksinha90.repl.co/view_nft_marketplace' class='w3-bar-item w3-button w3-mobile'>View NFT</a>        <a href='https://infynft.saurabhksinha90.repl.co/store_file' class='w3-bar-item w3-button w3-mobile'>Store NFT</a>     </div>    </div> <a href='https://infynft.saurabhksinha90.repl.co/send' class='w3-bar-item w3-button w3-mobile'>Send Asset</a><a href='https://infynft.saurabhksinha90.repl.co/receive' class='w3-bar-item w3-button w3-mobile'>Receive Asset</a>   <div class='w3-dropdown-hover w3-mobile'>      <button class='w3-button'>Asset <i class='fa fa-caret-down'></i></button>     <div class='w3-dropdown-content w3-bar-block w3-dark-grey'>        <a href='https://infynft.saurabhksinha90.repl.co/send' class='w3-bar-item w3-button w3-mobile'>Send</a>       <a href='https://infynft.saurabhksinha90.repl.co/receive' class='w3-bar-item w3-button w3-mobile'>Receive</a>         </div>    </div> </div><h2  style='color:blue;'>Store File via Moralis on IPFS</h2>    <form action='https://InfyNFT.saurabhksinha90.repl.co/store_success' method='get'>  <label for='path'>Path:</label>  <input type='text' id='path' name='path'><br><br>   <input type='submit' value='Upload' style='background-color:blue; border-color:black; color:white;  width:auto;'></form>   </div>  </body></html>");

});

app.get('/store_success', (req, res) => {
  var path = (req.query.path).replace("?", "\?");
  console.log('path' + path);
  


      fetch('https://deep-index.moralis.io/api/v2/ipfs/uploadFolder', {
        method: 'POST',
        headers: {
          'accept': 'application/json',
          'X-API-Key': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJub25jZSI6IjY2ODM3OGE3LWVkMjItNDk0NS04NDM1LTFhMWUyMWE0YWQ1OCIsIm9yZ0lkIjoiMjEzMDM4IiwidXNlcklkIjoiMjEyNzE4IiwidHlwZUlkIjoiMzk2NTU3ZDItZjUwNi00NDQxLTlhYmEtMmUyZjM2OTBlNTFiIiwidHlwZSI6IlBST0pFQ1QiLCJpYXQiOjE2ODU2Mzc4MTYsImV4cCI6NDg0MTM5NzgxNn0.Nsze3pKimlizkiimp4k6jE8aDEIWmAB_AuO5UCw-wVo',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify([
          {
            'path': path,
            'content': 'data:image/jpeg;base64,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'
          }
        ])
      }).then(res => res.json())
        .then(jsonData => {
          let a = (JSON.stringify(jsonData[0].path).replace("?", "%3F").replace(/[&]/g, "%26")).substring(1, (JSON.stringify(jsonData[0].path).replace("?", "%3F").replace(/[&]/g, "%26")).length - 1);
          console.log(jsonData);
          res.send('<html><link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><body><div class="w3-container">   <div class="w3-bar w3-black">    <a href="https://InfyNFT.saurabhksinha90.repl.co/home" class="w3-bar-item w3-button w3-mobile w3-green">Home</a>   <a href="https://infynft.saurabhksinha90.repl.co/store_file" class="w3-bar-item w3-button w3-mobile">Upload File</a>    <a href="https://infynft.saurabhksinha90.repl.co/nft_mint?metadata_media=" class="w3-bar-item w3-button w3-mobile">Mint NFT</a>   <div class="w3-dropdown-hover w3-mobile">      <button class="w3-button">NFT <i class="fa fa-caret-down"></i></button>     <div class="w3-dropdown-content w3-bar-block w3-dark-grey">        <a href="https://infynft.saurabhksinha90.repl.co/nft_mint?metadata_media=" class="w3-bar-item w3-button w3-mobile">Mint NFT</a>       <a href="https://infynft.saurabhksinha90.repl.co/view_nft_marketplace" class="w3-bar-item w3-button w3-mobile">View NFT</a>        <a href="https://infynft.saurabhksinha90.repl.co/store_file" class="w3-bar-item w3-button w3-mobile">Store NFT</a>     </div>    </div> <a href="https://infynft.saurabhksinha90.repl.co/send" class="w3-bar-item w3-button w3-mobile">Send Asset</a><a href="https://infynft.saurabhksinha90.repl.co/send" class="w3-bar-item w3-button w3-mobile">Receive Asset</a>   <div class="w3-dropdown-hover w3-mobile">      <button class="w3-button">Asset <i class="fa fa-caret-down"></i></button>     <div class="w3-dropdown-content w3-bar-block w3-dark-grey">        <a href="https://infynft.saurabhksinha90.repl.co/send" class="w3-bar-item w3-button w3-mobile">Send</a>       <a href="https://infynft.saurabhksinha90.repl.co/receive" class="w3-bar-item w3-button w3-mobile">Receive</a>         </div>    </div> </div><br/><b>Congratulations! Your file is successfully uploaded to IPFS via Moralis.</b><br/></br><img height="300px" src=' + JSON.stringify(jsonData[0].path).replace("?", "%3F") + '></br><br/><table><tr><td><b>File Path:</b><br/>' + path + '</td></tr><tr></tr><tr><td><br/><b>IPFS File Path:<br/></b>' + (JSON.stringify(jsonData[0].path).replace("?", "%3F")).substring(1, (JSON.stringify(jsonData[0].path).replace("?", "%3F")).length - 1) + '</td></tr></table><br/><a href="https://infynft.saurabhksinha90.repl.co/store_file"><button style="background-color:grey; border-color:black; color:white; width:33%;" type="submit">BACK</button></a>     <a href="https://infynft.saurabhksinha90.repl.co/nft_mint?metadata_media=' + a + '"><button style="background-color:green; border-color:black; color:white; width:33%;">MINT</button></a>     <a href="https://InfyNFT.saurabhksinha90.repl.co/home"><button  style="background-color:blue; border-color:black; color:white;  width:33%;" type="submit">HOME</button></a><br/><br/></div></body></html>')
        });
    }
  });
});

app.get('/nft_mint', (req, res) => {
  var metadata_media = (req.query.metadata_media);

  console.log('hi' + metadata_media);
  res.send("<html><style>body {font-family: Arial, Helvetica, sans-serif;}input[type=text], input[type=password] {  width: 100%; padding: 12px 20px;  margin: 8px 0; display: inline-block;  border: 1px solid #ccc; box-sizing: border-box;}button {  background-color: #04AA6D; color: white;  padding: 14px 20px; margin: 8px 0;  border: none; cursor: pointer;  width: 100%;utton:hover {  opacity: 0.8;cancelbtn {  width: auto; padding: 10px 18px;  background-color: #f44336;imgcontainer {  text-align: center; margin: 24px 0 12px 0;}img.avatar {  width: 40%; border-radius: 50%;}.container {  padding: 16px;pan.psw {  float: right; padding-top: 16px;}/* Change styles for span and cancel button on extra small screens */@media screen and (max-width: 300px) { span.psw {     display: block;    float: none;  } .cancelbtn {     width: 100%; }}</style><style>body {font-family: Arial, Helvetica, sans-serif;}input[type=text], input[type=password] {  width: 100%; padding: 12px 20px;  margin: 8px 0; display: inline-block;  border: 1px solid #ccc; box-sizing: border-box;}button {  background-color: #04AA6D; color: white;  padding: 14px 20px; margin: 8px 0;  border: none; cursor: pointer;  width: 100%;utton:hover {  opacity: 0.8;cancelbtn {  width: auto; padding: 10px 18px;  background-color: #f44336;imgcontainer {  text-align: center; margin: 24px 0 12px 0;}img.avatar {  width: 40%; border-radius: 50%;}.container {  padding: 16px;pan.psw {  float: right; padding-top: 16px;}/* Change styles for span and cancel button on extra small screens */@media screen and (max-width: 300px) { span.psw {     display: block;    float: none;  } .cancelbtn {     width: 100%; }}</style><link rel='stylesheet' href='https://www.w3schools.com/w3css/4/w3.css'><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'><body><div class='w3-container'>   <div class='w3-bar w3-black'>    <a href='https://InfyNFT.saurabhksinha90.repl.co/home' class='w3-bar-item w3-button w3-mobile w3-green'>Home</a>   <a href='https://infynft.saurabhksinha90.repl.co/store_file' class='w3-bar-item w3-button w3-mobile'>Upload File</a>    <a href='https://infynft.saurabhksinha90.repl.co/nft_mint?metadata_media=' class='w3-bar-item w3-button w3-mobile'>Mint NFT</a>   <div class='w3-dropdown-hover w3-mobile'>      <button class='w3-button'>NFT <i class='fa fa-caret-down'></i></button>     <div class='w3-dropdown-content w3-bar-block w3-dark-grey'>        <a href='https://infynft.saurabhksinha90.repl.co/nft_mint?metadata_media=' class='w3-bar-item w3-button w3-mobile'>Mint NFT</a>       <a href='https://infynft.saurabhksinha90.repl.co/view_nft_marketplace' class='w3-bar-item w3-button w3-mobile'>View NFT</a>        <a href='https://infynft.saurabhksinha90.repl.co/store_file' class='w3-bar-item w3-button w3-mobile'>Store NFT</a>     </div>    </div> <a href='https://infynft.saurabhksinha90.repl.co/send' class='w3-bar-item w3-button w3-mobile'>Send Asset</a><a href='https://infynft.saurabhksinha90.repl.co/receive' class='w3-bar-item w3-button w3-mobile'>Receive Asset</a>   <div class='w3-dropdown-hover w3-mobile'>      <button class='w3-button'>Asset <i class='fa fa-caret-down'></i></button>     <div class='w3-dropdown-content w3-bar-block w3-dark-grey'>        <a href='https://infynft.saurabhksinha90.repl.co/send' class='w3-bar-item w3-button w3-mobile'>Send</a>       <a href='https://infynft.saurabhksinha90.repl.co/receive' class='w3-bar-item w3-button w3-mobile'>Receive</a>         </div>    </div> </div><h2 style='color:blue;'>Store File via Moralis on IPFS</h2>   <div class='container'>  <form action='https://InfyNFT.saurabhksinha90.repl.co/nft_mint_success' method='get'>  <label for='token_id'><b>Token ID:</b></label>  <input type='text' id='token_id' name='token_id'value='This should be unique!'><label for='receiver_id'><b>Receiver ID:</b></label>  <input type='text' id='receiver_id' name='receiver_id' value='saurabhksinha900.testnet'><label for='description'><b>Description:</b></label>  <input type='text' id='description' name='description' value='Please write your description here!'><label for='contract'><b>Contract:</b></label>  <input type='text' id='contract' name='contract' value='saurabhksinha900.testnet'><label for='account_id'><b>Account ID:</b></label>  <input type='text' id='account_id' name='account_id' value='saurabhksinha900.testnet'><label for='seed_phrase'><b>Seed Phrase:</b></label>  <input type='text' id='seed_phrase' name='seed_phrase' value='next scene fury above pyramid travel chef help envelope invite surge slot'><label for='metadata_title'><b>Metadata Title:</b></label>  <input type='text' id='metadata_title' name='metadata_title' value='Test NFT'><label for='metadata_media'><b>Metadata Media:</b></label><input type='text' id='media' name='media' value=" + metadata_media.replace("?", "%3F").replace(/[&]/g, "%26") + "><br><br>   <input type='submit' value='Submit'></form>   </div></body></html>");

});

app.get('/nft_mint_success', (req, res) => {
  var token_id = req.query.token_id;
  var receiver_id = req.query.receiver_id;
  var description = req.query.description;
  var contract = req.query.contract;
  var account_id = req.query.account_id;
  var seed_phrase = req.query.seed_phrase;
  var metadata_title = req.query.metadata_title;
  var media = (req.query.media).replace("?", "%3F").replace(/[&]/g, "%26");
  console.log('NFT mint success!');
  console.log(token_id);
  console.log(receiver_id);
  console.log(description);
  console.log(contract);
  console.log(account_id);
  console.log(seed_phrase);
  console.log(metadata_title);
  console.log(media);

  var request = require('request');

  var options = {
    url: 'https://miserabletimelyquery.saurabhksinha90.repl.co/mint_nft?token_id=' + token_id + '&receiver_id=' + receiver_id + '&description=' + description + '&media=' + media.replace("?", "%3F").replace(/[&]/g, "%26") + '&contract=' + contract + '&account_id=' + account_id + '&seedphrase=' + seed_phrase + '&title=' + metadata_title
  };

  function callback(error, response, body) {
    if (!error && response.statusCode == 200) {
      console.log(body);
      res.send("<html><link rel='stylesheet' href='https://www.w3schools.com/w3css/4/w3.css'><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'><body><div class='w3-container'>   <div class='w3-bar w3-black'>    <a href='https://InfyNFT.saurabhksinha90.repl.co/home' class='w3-bar-item w3-button w3-mobile w3-green'>Home</a>   <a href='https://infynft.saurabhksinha90.repl.co/store_file' class='w3-bar-item w3-button w3-mobile'>Upload File</a>    <a href='https://infynft.saurabhksinha90.repl.co/nft_mint?metadata_media=' class='w3-bar-item w3-button w3-mobile'>Mint NFT</a>   <div class='w3-dropdown-hover w3-mobile'>      <button class='w3-button'>NFT <i class='fa fa-caret-down'></i></button>     <div class='w3-dropdown-content w3-bar-block w3-dark-grey'>        <a href='https://infynft.saurabhksinha90.repl.co/nft_mint?metadata_media=' class='w3-bar-item w3-button w3-mobile'>Mint NFT</a>       <a href='https://infynft.saurabhksinha90.repl.co/view_nft_marketplace' class='w3-bar-item w3-button w3-mobile'>View NFT</a>        <a href='https://infynft.saurabhksinha90.repl.co/store_file' class='w3-bar-item w3-button w3-mobile'>Store NFT</a>     </div>    </div>  <a href='https://infynft.saurabhksinha90.repl.co/send' class='w3-bar-item w3-button w3-mobile'>Send Asset</a><a href='https://infynft.saurabhksinha90.repl.co/receive' class='w3-bar-item w3-button w3-mobile'>Receive Asset</a>   <div class='w3-dropdown-hover w3-mobile'>      <button class='w3-button'>Asset <i class='fa fa-caret-down'></i></button>     <div class='w3-dropdown-content w3-bar-block w3-dark-grey'>        <a href='https://infynft.saurabhksinha90.repl.co/send' class='w3-bar-item w3-button w3-mobile'>Send</a>       <a href='https://infynft.saurabhksinha90.repl.co/receive' class='w3-bar-item w3-button w3-mobile'>Receive</a>         </div>    </div></div><br/><img height='300px' src='" + media + "'><br/><B>Congratulations! </B>Your NFT has been minted successfully. Transaction ID: " + body + "<br/><table><tr><td>Token ID:</td><td></td><td>" + token_id + "</td></tr><tr></tr><tr><td>Receiver ID:</td><td></td><td>" + receiver_id + "</td></tr><tr></tr><tr><td>Description</td><td></td><td>" + description + "</td></tr><tr></tr><tr><td>Metadata Title:</td><td></td><td>" + metadata_title + "</td></tr><tr><tr><td>Media:</td><td></td><td>" + media + "</td></tr><tr></tr><tr><td>Contract:</td><td></td><td>" + contract + "</td></tr><tr></tr><tr><td>Account ID:</td><td></td><td>" + account_id + "</td></tr><tr></tr><tr><td>Seed Phrase:</td><td></td><td>" + seed_phrase + "</td></tr><tr></tr></table><br/><a href='https://explorer.testnet.near.org/transactions/" + body + "' target='_blank'><input type='submit' value='Transaction Receipt' style='background-color:blue; border-color:black; color:white;  width:auto;'></div></body></html>");
    }
  }

  request(options, callback);


});

app.get('/nft_transfer', (req, res) => {
  var token_id = req.query.token_id;
  var metadata_media = req.query.metadata_media;
  var owner_id = req.query.owner_id;
  var metadata_description = req.query.metadata_description;
  var metadata_title = req.query.metadata_title;
  var metadata_copies = req.query.metadata_copies;
  var metadata_media_hash = req.query.metadata_media_hash;
  var metadata_issued_at = req.query.metadata_issued_at;
  var metadata_expires_at = req.query.metadata_expires_at;
  var metadata_starts_at = req.query.metadata_starts_at;
  var metadata_updated_at = req.query.metadata_updated_at;
  var metadata_reference = req.query.metadata_reference;
  var metadata_reference_hash = req.query.metadata_reference_hash;
  var metadata_extra = req.query.metadata_extra;
  var metadata_reference = req.query.metadata_reference;
  var approved_account_ids = req.query.approved_account_ids;
  let text = "<head><style>body {font-family: Arial, Helvetica, sans-serif;}/* Full-width input fields */input[type=text], input[type=password] {  width: 100%;  padding: 12px 20px;  margin: 8px 0;  display: inline-block;  border: 1px solid #ccc;  box-sizing: border-box;}/* Set a style for all buttons */button {  background-color: #04AA6D;  color: white;  padding: 14px 20px;  margin: 8px 0;  border: none;  cursor: pointer;  width: 100%;}button:hover {  opacity: 0.8;}/* Extra styles for the cancel button */.cancelbtn {  width: auto;  padding: 10px 18px;  background-color: #f44336;}/* Center the image and position the close button */.imgcontainer {  text-align: center;  margin: 24px 0 12px 0;  position: relative;}img.avatar {  width: 20%;  border-radius: 50%;}.container {  padding: 16px;}span.psw {  float: right;  padding-top: 16px;}/* The Modal (background) */.modal {  display: none; /* Hidden by default */  position: fixed; /* Stay in place */  z-index: 1; /* Sit on top */  left: 0;  top: 0;  width: 100%; /* Full width */  height: 100%; /* Full height */  overflow: auto; /* Enable scroll if needed */  background-color: rgb(0,0,0); /* Fallback color */  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */  padding-top: 60px;}/* Modal Content/Box */.modal-content {  background-color: #fefefe;  margin: 5% auto 15% auto; /* 5% from the top, 15% from the bottom and centered */  border: 1px solid #888;  width: 80%; /* Could be more or less, depending on screen size */}/* The Close Button (x) */.close {  position: absolute;  right: 25px;  top: 0;  color: #000;  font-size: 35px;  font-weight: bold;}.close:hover,.close:focus {  color: red;  cursor: pointer;}/* Add Zoom Animation */.animate {  -webkit-animation: animatezoom 0.6s;  animation: animatezoom 0.6s}@-webkit-keyframes animatezoom {  from {-webkit-transform: scale(0)}   to {-webkit-transform: scale(1)}}  @keyframes animatezoom {  from {transform: scale(0)}   to {transform: scale(1)}}/* Change styles for span and cancel button on extra small screens */@media screen and (max-width: 300px) {  span.psw {     display: block;     float: none;  }  .cancelbtn {     width: 100%;  }}</style></head>  <link rel='stylesheet' href='/w3css/3/w3.css'><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css'><section>  <img class='mySlides' src='" + metadata_media + "'  style='width:50%; height:50%;'>  </section><section class='w3-container w3-center w3-content' style='max-width:1000px'>  <h2 class='w3-wide'>" + metadata_title + "</h2>  <p class='w3-opacity'><i>Owner ID: " + owner_id + "</i></p> <p class='w3-opacity'><i>Token ID: " + token_id + "</i></p> <p class='w3-opacity'><i>Metadata Media URL: " + metadata_media + "</i></p> <p class='w3-opacity'><i>Metadata Copies: " + metadata_copies + "</i></p><p class='w3-justify'>Metadata Description: " + metadata_description + "</p><p class='w3-justify'>Metadata Media Hash: " + metadata_media_hash + "</p><p class='w3-justify'>Metadata Issued At: " + metadata_issued_at + "</p><p class='w3-justify'>Metadata Expires At: " + metadata_expires_at + "</p><p class='w3-justify'>Metadata Starts At: " + metadata_starts_at + "</p><p class='w3-justify'>Metadata Updated At: " + metadata_updated_at + "</p><p class='w3-justify'>Metadata Extra: " + metadata_extra + "</p><p class='w3-justify'>Metadata Reference: " + metadata_reference + "</p><p class='w3-justify'>Metadata Reference Hash: " + metadata_reference_hash + "</p><p class='w3-justify'>Approved Account Ids: " + approved_account_ids + "</p> </section><button onclick='document.getElementById(&quot;id01&quot;).style.display=&quot;block&quot'; style='width:auto;'>Transfer</button></br></br><footer class='w3-container w3-padding-64 w3-center w3-black w3-xlarge'>  <a ref='#'><i class='fa fa-facebook-official'></i></a>  <a href='#'><i class='fa fa-pinterest-p'></i></a>  <a href='#'><i class='fa fa-twitter'></i></a>  <a href='#'><i class='fa fa-flickr'></i></a>  <a href='#'><i class='fa fa-linkedin'></i></a>  <p class='w3-medium'>  </p></footer> <div id='id01' class='modal'>    <form class='modal-content animate' action='https://InfyNFT.saurabhksinha90.repl.co/success_nft_transfer' method='get'>    <div class='imgcontainer'>      <span onclick='document.getElementById(&quot;id01&quot;).style.display=&quot;none&quot;' class='close' title='Close Modal'>&times;</span>      <img src='https://www.kindpng.com/picc/m/495-4952535_create-digital-profile-icon-blue-user-profile-icon.png' alt='Avatar' class='avatar'>    </div>    <div class='container'>      <label for='receiver_id'><b>Receiver Address</b></label>      <input type='text' placeholder='Enter Username' name='receiver_id' required>  <input type = 'hidden' name = 'token_id' value = '" + token_id + "' />               <button type='submit'>Transfer</button>        </div>    <div class='container' style='background-color:#f1f1f1'>      <button type='button' onclick='document.getElementById(&quot;id01&quot;).style.display=&quot;none&quot;' class='cancelbtn'>Cancel</button>          </div>  </form></div><script>var modal = document.getElementById('id01');window.onclick = function(event) {    if (event.target == modal) {        modal.style.display = 'none';    }}</script>";
  res.send(text);
});
app.get('/success_nft_transfer', (req, res) => {

  var token_id = req.query.token_id;
  var receiver_id = req.query.receiver_id;
  var options = {
    "method": "GET"
  };
  fetch('https://miserabletimelyquery.saurabhksinha90.repl.co/transfer_nft?token_id=' + token_id + '&receiver_id=' + receiver_id + '&enforce_owner_id=saurabhksinha900.testnet&memo=Hi&contract=saurabhksinha900.testnet&seedphrase=next%20scene%20fury%20above%20pyramid%20travel%20chef%20help%20envelope%20invite%20surge%20slot', options).then(res => res.json())
    .then((jsontoken) => {
      res.send("<html><link rel='stylesheet' href='https://www.w3schools.com/w3css/4/w3.css'><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'><body><div class='w3-container'>   <div class='w3-bar w3-black'>    <a href='https://InfyNFT.saurabhksinha90.repl.co/home' class='w3-bar-item w3-button w3-mobile w3-green'>Home</a>   <a href='https://infynft.saurabhksinha90.repl.co/store_file' class='w3-bar-item w3-button w3-mobile'>Upload File</a>    <a href='https://infynft.saurabhksinha90.repl.co/nft_mint?metadata_media=' class='w3-bar-item w3-button w3-mobile'>Mint NFT</a>   <div class='w3-dropdown-hover w3-mobile'>      <button class='w3-button'>NFT <i class='fa fa-caret-down'></i></button>     <div class='w3-dropdown-content w3-bar-block w3-dark-grey'>        <a href='https://infynft.saurabhksinha90.repl.co/nft_mint?metadata_media=' class='w3-bar-item w3-button w3-mobile'>Mint NFT</a>       <a href='https://infynft.saurabhksinha90.repl.co/view_nft_marketplace' class='w3-bar-item w3-button w3-mobile'>View NFT</a>        <a href='https://infynft.saurabhksinha90.repl.co/store_file' class='w3-bar-item w3-button w3-mobile'>Store NFT</a>     </div>    </div>  <a href='https://infynft.saurabhksinha90.repl.co/send' class='w3-bar-item w3-button w3-mobile'>Send Asset</a><a href='https://infynft.saurabhksinha90.repl.co/receive' class='w3-bar-item w3-button w3-mobile'>Receive Asset</a>   <div class='w3-dropdown-hover w3-mobile'>      <button class='w3-button'>Asset <i class='fa fa-caret-down'></i></button>     <div class='w3-dropdown-content w3-bar-block w3-dark-grey'>        <a href='https://infynft.saurabhksinha90.repl.co/send' class='w3-bar-item w3-button w3-mobile'>Send</a>       <a href='https://infynft.saurabhksinha90.repl.co/receive' class='w3-bar-item w3-button w3-mobile'>Receive</a>         </div>    </div></div><br/><b>Transaction ID: " + jsontoken.tx + "</b><br/></br> <br/>Transferred Token Id " + token_id + " to " + receiver_id + ".<br/><br/><a href='https://explorer.testnet.near.org/transactions/" + jsontoken.tx + "'>Click Here to see more details!</a>'</div></body></html>");
    });


});
app.get('/view_nft_marketplace', (req, res) => {

  var options = {
    "method": "GET"
  };
  fetch('https://miserabletimelyquery.saurabhksinha90.repl.co/view_nft?account_id=saurabhksinha900.testnet', options).then(res => res.json())
    .then((jsontoken) => {
      console.log(jsontoken[0]);
      let text = '<html><link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><body><div class="w3-container">   <div class="w3-bar w3-black">    <a href="https://InfyNFT.saurabhksinha90.repl.co/home" class="w3-bar-item w3-button w3-mobile w3-green">Home</a>   <a href="https://infynft.saurabhksinha90.repl.co/store_file" class="w3-bar-item w3-button w3-mobile">Upload File</a>    <a href="https://infynft.saurabhksinha90.repl.co/nft_mint?metadata_media=" class="w3-bar-item w3-button w3-mobile">Mint NFT</a>   <div class="w3-dropdown-hover w3-mobile">      <button class="w3-button">NFT <i class="fa fa-caret-down"></i></button>     <div class="w3-dropdown-content w3-bar-block w3-dark-grey">        <a href="https://infynft.saurabhksinha90.repl.co/nft_mint?metadata_media=" class="w3-bar-item w3-button w3-mobile">Mint NFT</a>       <a href="https://infynft.saurabhksinha90.repl.co/view_nft_marketplace" class="w3-bar-item w3-button w3-mobile">View NFT</a>        <a href="https://infynft.saurabhksinha90.repl.co/store_file" class="w3-bar-item w3-button w3-mobile">Store NFT</a>     </div>    </div> <a href="https://infynft.saurabhksinha90.repl.co/send" class="w3-bar-item w3-button w3-mobile">Send Asset</a><a href="https://infynft.saurabhksinha90.repl.co/receive" class="w3-bar-item w3-button w3-mobile">Receive Asset</a>   <div class="w3-dropdown-hover w3-mobile">      <button class="w3-button">Asset <i class="fa fa-caret-down"></i></button>     <div class="w3-dropdown-content w3-bar-block w3-dark-grey">        <a href="https://infynft.saurabhksinha90.repl.co/send" class="w3-bar-item w3-button w3-mobile">Send</a>       <a href="https://infynft.saurabhksinha90.repl.co/receive" class="w3-bar-item w3-button w3-mobile">Receive</a>         </div>    </div></div>';
      text = text + "<H1 align='center'  style='color:blue;'> Rewards and Recognition Platform</h1><br><br><table align='center' style='border: 1px solid black;'><tr style='border: 1px solid black;'><td align='center' style='border: 1px solid black;'><b>metadata_media</b></td><td align='center'style='border: 1px solid black;'> <b>token_id</b></td><td align='center' style='border: 1px solid black;'> <b>owner_id</b></td><td align='center' style='border: 1px solid black;'> <b>metadata_title</b></td><td align='center' style='border: 1px solid black;'> <b>metadata_description</b></td><td align='center' style='border: 1px solid black;'> <b>metadata_copies</td><td align='center' style='border: 1px solid black;'> <b>Transfer NFT</b></td></tr>"

      for (var i = 0; i < jsontoken.length; i++) {

        text = text + "<tr style='border: 1px solid black;'><td align='center' style='border: 1px solid black;'> <a href='https://infynft.saurabhksinha90.repl.co/nft_transfer?token_id=" + jsontoken[i].token_id + "&metadata_media=" + (jsontoken[i].metadata_media).replace("?", "%3F") + "&metadata_title=" + (jsontoken[i].metadata_title) + "&metadata_description=" + (jsontoken[i].metadata_description) + "&metadata_copies=" + (jsontoken[i].metadata_copies) + "&metadata_media_hash=" + (jsontoken[i].metadata_media_hash) + "&metadata_issued_at=" + (jsontoken[i].metadata_issued_at) + "&metadata_expires_at=" + (jsontoken[i].metadata_expires_at) + "&metadata_starts_at=" + (jsontoken[i].metadata_starts_at) + "&metadata_updated_at=" + (jsontoken[i].metadata_updated_at) + "&metadata_extra=" + (jsontoken[i].metadata_extra) + "&metadata_reference=" + (jsontoken[i].metadata_reference) + "&metadata_reference_hash=" + (jsontoken[i].metadata_reference_hash) + "&approved_account_ids=" + (jsontoken[i].approved_account_ids) + "&owner_id=" + (jsontoken[i].owner_id) + "'><img height='37px' width='37px' src='" + (jsontoken[i].metadata_media).replace("?", "%3F") + "'></a></td><td align='center' style='border: 1px solid black;'> <b>" + (jsontoken[i].token_id) + "</b></td><td align='center' style='border: 1px solid black;'> <b>" + (jsontoken[i].owner_id) + "</b></td><td align='center' style='border: 1px solid black;'> <b>" + (jsontoken[i].metadata_title) + "</b></td><td align='center' style='border: 1px solid black;'> <b>" + (jsontoken[i].metadata_description) + "</b></td><td align='center' style='border: 1px solid black;'> <b>" + (jsontoken[i].metadata_copies) + "</b></td><td align='center' style='border: 1px solid black;'> <a href='https://infynft.saurabhksinha90.repl.co/nft_transfer?token_id=" + jsontoken[i].token_id + "&metadata_media=" + (jsontoken[i].metadata_media).replace("?", "%3F") + "&metadata_title=" + (jsontoken[i].metadata_title) + "&metadata_description=" + (jsontoken[i].metadata_description) + "&metadata_copies=" + (jsontoken[i].metadata_copies) + "&metadata_media_hash=" + (jsontoken[i].metadata_media_hash) + "&metadata_issued_at=" + (jsontoken[i].metadata_issued_at) + "&metadata_expires_at=" + (jsontoken[i].metadata_expires_at) + "&metadata_starts_at=" + (jsontoken[i].metadata_starts_at) + "&metadata_updated_at=" + (jsontoken[i].metadata_updated_at) + "&metadata_extra=" + (jsontoken[i].metadata_extra) + "&metadata_reference=" + (jsontoken[i].metadata_reference) + "&metadata_reference_hash=" + (jsontoken[i].metadata_reference_hash) + "&approved_account_ids=" + (jsontoken[i].approved_account_ids) + "&owner_id=" + (jsontoken[i].owner_id) + "'><button onclick='document.getElementById(&quot;id01&quot;).style.display=&quot;block&quot;' style='background-color:blue; border-color:black; color:white;  width:auto;'>Transfer NFT!</button></a></td></tr>";
      }
      text = text + "</table></div><br/><br/></body></html>";

      res.send(text);
    });
});

app.get('*', (req, res) => {
  res.status(404).send("Not Found");
});

// Listen and serve.
const PORT = process.env.PORT || 3000;
server.listen(PORT, () => {
  console.log(`App started on PORT ${PORT}`);
});
